<!DOCTYPE html>
<html>
<head>
    <title>Mainfo Timeline</title>

    <script src="http://code.jquery.com/jquery-2.1.0.min.js"></script>
    <script src="http://underscorejs.org/underscore.js"></script>
    <link href="c3.css" rel="stylesheet">
    <style>
    </style>
</head>
<body>


<div id="chart"></div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.5/d3.min.js" charset="utf-8"></script>
<!-- <script src="../node_modules/simpleheat/simpleheat.js"></script>
<script src="../src/HeatLayer.js"></script> -->

<!--<script src="src/HeatLayer.js"></script>-->
<script src="c3.js"></script>
<script src="src/simpleheat.js"></script>

<!--<script src="http://leaflet.github.io/Leaflet.markercluster/example/realworld.10000.js"></script>-->

<script>

var groups = {};

$.getJSON("http://raw.githubusercontent.com/mainfo/data/master/data.json", function(data) {
    var heat = [];
    var last_update = data.last_update;
    $(".update").html("Last update: " + last_update);
    
    var lsp = [];
	
	$.each(data.features, function(ind, feature) {
		console.log(feature);
        var lng = feature.geometry.coordinates[0];
        var lat = feature.geometry.coordinates[1];
        var date_add = feature.properties.incident_dateadd;
        ind = date_add.split(" ");
        console.log(date_add);
        obj = {
            name: ind[0],
            lat: lat,
            lng:lng
        };

        lsp.push(obj);
      
    });

    //console.log(lsp);
    var gpby = _.groupBy(lsp,'name');
    
    var xs = ['Updates'];
    var timeset =['x'];

    $.each(gpby, function( index, value ) {
      ind = index;
      //obj2 = {
            //lng : ind[0],
            //lat: ind[1],
            //count:value.length
      //};
      var time = ind;
      var x = value.length
      console.log(time);
      timeset.push(time);
      xs.push(x);
      
    });

    console.log(xs);
    console.log(timeset);

    var chart = c3.generate({
	    data: {
	        x: 'x',
	//        xFormat: '%Y%m%d', // 'xFormat' can be used as custom format of 'x'
	        columns: [
	            timeset,
	//            ['x', '20130101', '20130102', '20130103', '20130104', '20130105', '20130106'],
	            xs
	        ]
	    },
	    axis: {
	        x: {
	            type: 'timeseries',
	            tick: {
	                format: '%d-%m-%Y',
	                count: 4,
	            }
	        }
	    }
	});
   
    //console.log(reduce);
    
});

</script>
</body>
</html>
